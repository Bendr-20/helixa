import{j as v}from"./vendor-wallet-iWeBopzN.js";import{r as p,R as h}from"./vendor-react-NLnOsXgy.js";import{b as k,a as D,r as P,I as $,E as i,aq as x,cp as _,ao as f,bj as W}from"./index-LpxkZPcU.js";import{i as j,B as M,C as F,o as Y,h as H,s as q,d as V,n as B,l as Q,e as G,r as J}from"./twitch-5IOe4sIQ-D---MrJS.js";import{F as K}from"./GlobeAltIcon-kW1lCngP.js";import{a as X}from"./shouldProceedtoEmbeddedWalletCreationFlow-BMF_3TVv-Ccps15Fb.js";import{n as z}from"./ScreenLayout-DTmQLGPf-iUv4NByI.js";import{e as Z}from"./capitalizeFirstLetter-DmLYqXsO-tV1Idewc.js";import"./ModalHeader-D8-mhjp4-DbfDVZJY.js";import"./Screen-Bp-TN9gb-D-62VcWr.js";import"./index-Dq_xe9dz-CZjfmRp1.js";const ee=({style:t})=>v.jsx(K,{style:{color:"var(--privy-color-error)",...t}});let O={google:{name:"Google",component:J},discord:{name:"Discord",component:G},github:{name:"Github",component:Q},linkedin:{name:"LinkedIn",component:B},twitter:{name:"Twitter",component:V},spotify:{name:"Spotify",component:q},instagram:{name:"Instagram",component:H},tiktok:{name:"Tiktok",component:Y},line:{name:"LINE",component:F},twitch:{name:"Twitch",component:M},apple:{name:"Apple",component:j}},te=({iconUrl:t,...o})=>h.createElement("svg",{width:"33",height:"32",viewBox:"0 0 33 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",...o},h.createElement("foreignObject",{x:"2",y:"2",width:"29",height:"28"},h.createElement("img",{src:t,width:"29",height:"28",style:{display:"block",objectFit:"contain",borderRadius:"4px"},alt:"Provider icon"})));const y=(t,o)=>{if(t in O)return O[t];if(W(t)&&o){let a=o.find((e=>e.provider===t));if(a)return{name:a.provider_display_name,component:e=>h.createElement(te,{...e,iconUrl:a.provider_icon_url})}}return{name:"Unknown",component:ee}};function re(t,o,a){let e={detail:"",retryable:!1},s=Z(o);if(t?.privyErrorCode===i.LINKED_TO_ANOTHER_USER&&(e.detail="This account has already been linked to another user."),t?.privyErrorCode===i.INVALID_CREDENTIALS&&(e.retryable=!0,e.detail="Something went wrong. Try again."),t.privyErrorCode===i.OAUTH_USER_DENIED&&(e.detail=`Retry and check ${s} to finish connecting your account.`,e.retryable=!0),t?.privyErrorCode===i.TOO_MANY_REQUESTS&&(e.detail="Too many requests. Please wait before trying again."),t?.privyErrorCode===i.TOO_MANY_REQUESTS&&t.message.includes("provider rate limit")){let n=y(o,a).name;e.detail=`Request limit reached for ${n}. Please wait a moment and try again.`}if(t?.privyErrorCode===i.OAUTH_ACCOUNT_SUSPENDED){let n=y(o,a).name;e.detail=`Your ${n} account is suspended. Please try another login method.`}return t?.privyErrorCode===i.CANNOT_LINK_MORE_OF_TYPE&&(e.detail="You cannot authorize more than one account for this user."),t?.privyErrorCode===i.OAUTH_UNEXPECTED&&o.startsWith("privy:")&&(e.detail="Something went wrong. Please try again."),e}const oe=({providerName:t,ProviderLogo:o,success:a,errorMessage:e,onRetry:s})=>{let n=a?`Successfully connected with ${t}`:e?e.message:`Verifying connection to ${t}`;return v.jsx(z,{title:n,subtitle:a?"You're good to go!":e?e.detail:"Just a few moments more",icon:o,iconVariant:"loading",iconLoadingStatus:{success:a,fail:!!e},secondaryCta:e?.retryable&&s?{label:"Retry",onClick:s}:void 0,watermark:!0})},Ee={component:()=>{let{authenticated:t,logout:o,ready:a,user:e}=k(),{setModalData:s,navigate:n,resetNavigation:l}=D(),u=P(),{getAuthMeta:g,initLoginWithOAuth:R,loginWithOAuth:C,updateWallets:w,setReadyToTrue:S,closePrivyModal:N,createAnalyticsEvent:b}=$(),[E,U]=p.useState(!1),[T,c]=p.useState(void 0),d=g()?.provider||"google",{name:A,component:I}=y(d,u.customOAuthProviders);return p.useEffect((()=>{C(d).then((()=>{U(!0),S(!0)})).catch((r=>{if(S(!1),r?.privyErrorCode===i.ALLOWLIST_REJECTED)return c(void 0),l(),void n("AllowlistRejectionScreen");if(r?.privyErrorCode===i.USER_LIMIT_REACHED)return console.error(new x(r).toString()),c(void 0),l(),void n("UserLimitReachedScreen");if(r?.privyErrorCode===i.USER_DOES_NOT_EXIST)return c(void 0),l(),void n("AccountNotFoundScreen");if(r?.privyErrorCode===i.ACCOUNT_TRANSFER_REQUIRED&&r.data?.data?.nonce)return c(void 0),l(),s({accountTransfer:{nonce:r.data?.data?.nonce,account:r.data?.data?.subject,displayName:r.data?.data?.account?.displayName,linkMethod:g()?.provider,embeddedWalletAddress:r.data?.data?.otherUser?.embeddedWalletAddress,oAuthUserInfo:r.data?.data?.otherUser?.oAuthUserInfo}}),void n("LinkConflictScreen");let{retryable:m,detail:L}=re(r,d,u.customOAuthProviders);c({retryable:m,detail:L,message:"Authentication failed"})})).finally((()=>{_()}))}),[A,d]),p.useEffect((()=>{if(a&&t&&E&&e){if(u?.legal.requireUsersAcceptTerms&&!e.hasAcceptedTerms){let r=setTimeout((()=>{n("AffirmativeConsentScreen")}),f);return()=>clearTimeout(r)}if(X(e,u.embeddedWallets)){let r=setTimeout((()=>{s({createWallet:{onSuccess:()=>{},onFailure:m=>{console.error(m),b({eventName:"embedded_wallet_creation_failure_logout",payload:{error:m,provider:d,screen:"OAuthStatusScreen"}}),o()},callAuthOnSuccessOnClose:!0}}),n("EmbeddedWalletOnAccountCreateScreen")}),f);return()=>clearTimeout(r)}{let r=setTimeout((()=>N({shouldCallAuthOnSuccess:!0,isSuccess:!0})),f);return w(),()=>clearTimeout(r)}}}),[a,t,E,e]),v.jsx(oe,{providerName:A,ProviderLogo:I,success:E,errorMessage:T,onRetry:T?.retryable?()=>{_(),R(d),c(void 0)}:void 0})},isShownBeforeReady:!0};export{Ee as OAuthStatusScreen,oe as OAuthStatusScreenView,Ee as default};
