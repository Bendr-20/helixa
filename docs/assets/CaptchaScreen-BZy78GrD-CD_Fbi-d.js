import{j as k}from"./vendor-wallet-iWeBopzN.js";import{r as t}from"./vendor-react-NLnOsXgy.js";import{a as E,aA as I,aB as q}from"./index-CSSJgmjD.js";import{n as A}from"./ScreenLayout-DTmQLGPf-JFzJyKww.js";import{C as j}from"./circle-check-big-YWHND4yl.js";import{C as M}from"./circle-x-CUSNfWSY.js";import"./ModalHeader-D8-mhjp4-eGkg8LHE.js";import"./Screen-Bp-TN9gb-CWXgsgm4.js";import"./index-Dq_xe9dz-Bvh5n9N6.js";import"./createLucideIcon-4wkIQryq.js";const P=({status:r,title:f,description:u,userIntentRequired:g,retriesRemaining:a,hasSelectedCta:n,onContinue:o,onRetry:c})=>{let l=t.useMemo((()=>{switch(r){case"loading":default:return;case"success":return g?{label:n?"Continuing...":"Continue",onClick:o,disabled:n,loading:n}:void 0;case"error":return a>0?{label:"Retry",onClick:c}:void 0}}),[r,n,o,c]),i=t.useMemo((()=>({loading:"loading",ready:"subtle",disabled:"subtle",success:"success",error:"error"})[r]||"loading"),[r]);return k.jsx(A,{icon:r==="loading"||r==="ready"?void 0:r==="success"?j:M,iconVariant:i,title:f,subtitle:u,primaryCta:l,watermark:!0})},z={component:()=>{let{lastScreen:r,data:f,navigate:u,setModalData:g}=E(),{status:a,token:n,waitForResult:o,reset:c,execute:l}=I(),i=t.useRef([]),p=e=>{i.current=[e,...i.current]},[S,w]=t.useState(!0);t.useEffect((()=>(p(setTimeout(w,1e3,!1)),()=>{i.current.forEach((e=>clearTimeout(e))),i.current=[]})),[]);let[T,C]=t.useState(""),[v,y]=t.useState("Checking that you are a human..."),[R,b]=t.useState(!1),[h,x]=t.useState(3),s=f?.captchaModalData,d=async e=>{try{await s?.callback(e),s?.onSuccessNavigateTo&&u(s?.onSuccessNavigateTo,!1)}catch(m){if(m instanceof q)return;g({errorModalData:{error:m,previousScreen:r||"LandingScreen"}}),u(s?.onErrorNavigateTo||"ErrorScreen",!1)}};return t.useEffect((()=>{a==="success"?p(setTimeout((async()=>{let e=await o();!e||s?.userIntentRequired||d(e)}),1e3)):a==="ready"&&p(setTimeout((()=>{a==="ready"&&l()}),500))}),[a]),t.useEffect((()=>{if(!S)switch(a){case"success":C("Success!"),y("CAPTCHA passed successfully."),s?.userIntentRequired||setTimeout((()=>{b(!0),d(n)}),2e3);break;case"loading":C(""),y("Checking that you are a human...");break;case"error":C("Something went wrong"),y(h<=0?"If you use an adblocker or VPN, try disabling and re-attempting.":"You did not pass CAPTCHA. Please try again.")}}),[a,S,R]),k.jsx(P,{status:a,title:T,description:v,userIntentRequired:s?.userIntentRequired,retriesRemaining:h,hasSelectedCta:R,onContinue:()=>{b(!0),d(n)},onRetry:async()=>{if(h<=0)return;x((m=>m-1)),c(),l();let e=await o();!e||s?.userIntentRequired||d(e)}})}};export{z as CaptchaScreen,P as CaptchaScreenView,z as default};
