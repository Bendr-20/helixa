import{j as d}from"./vendor-wallet-iWeBopzN.js";import{r as o}from"./vendor-react-NLnOsXgy.js";import{b as B,r as j,a as F}from"./index-CSSJgmjD.js";import{K as V,R as P,q as D,X as S}from"./to-ui-error-REESv0kM-B545HT8q.js";import"./PinInput-3SLvbnQa-_Yx2iVNl.js";import"./FingerPrintIcon-CQ2UnhCX.js";import"./PhoneIcon-DQtHTqgM.js";import"./ShieldCheckIcon-CzN8v7s7.js";import"./ModalHeader-D8-mhjp4-eGkg8LHE.js";import"./ScreenLayout-DTmQLGPf-JFzJyKww.js";import"./Screen-Bp-TN9gb-CWXgsgm4.js";import"./index-Dq_xe9dz-Bvh5n9N6.js";import"./ExclamationTriangleIcon-C_T-rHXN.js";import"./StackedContainer-B2vaEl56-D7buDdCY.js";import"./useGetTokenPrice-BPBpM07F-B6vluimU.js";import"./useGetSolPrice-DwwjjGbd-C8WfM5O7.js";import"./TransactionDetails-BurRo8R0-DFSXptul.js";import"./WalletLink--05Hzo2b-BYarUQXX.js";import"./ethers-D1WT71Ay-DiR7zjZU.js";import"./getFormattedUsdFromLamports-B6EqSEho-C-HCdwKa.js";import"./transaction-CnfuREWo-nROljJQP.js";import"./Layouts-BlFm53ED-B5_Cpu_1.js";import"./ChevronDownIcon-Drg772V5.js";const oe={component:()=>{let{user:l}=B(),y=j(),a=o.useMemo((()=>l?.mfaMethods.filter((e=>e!=="passkey"||!y.globalDisablePasskeys))??[]),[l?.mfaMethods,y.globalDisablePasskeys]),{data:h}=F(),[t,s]=o.useState(a[0]),[f,k]=o.useState(!1),[m,M]=o.useState(),[n,i]=o.useState();if(o.useEffect((()=>{s(a[0])}),[a]),!h?.mfaVerify)throw Error("Missing modal data for MFA verification screen.");let{onFailure:E,onSuccess:c,generateOptions:b,verifyTotpCode:C,verifyPasskey:v,verifySmsCode:x,sendSmsCode:A}=h.mfaVerify,g=async e=>{if(e!=="passkey")try{s(e),e==="sms"&&(s(e),await A()),e==="totp"&&s(e)}catch(r){console.error(r)}else try{s(e);let r=await b();if(!r)throw Error("something went wrong");M(r),await v(r),k(!0),i(void 0),c()}catch(r){i(S(r))}},w=async e=>{i(void 0);try{if(!e||!t)return;if(t==="passkey"){if(!m)throw Error("Missing passkey challenge");await v(m)}else t==="sms"?await x(e):t==="totp"&&await C(e);i(void 0),k(!0),c()}catch(r){throw S(r).error}},p=()=>{n||!f?E(n?.error??Error("Canceled MFA verification.")):c()},u=o.useRef(!1);return o.useEffect((()=>{!u.current&&t&&(u.current=!0,g(t).finally((()=>{u.current=!1})))}),[open]),l?t==="passkey"?d.jsx(V,{account:l.linkedAccounts.filter((e=>e.type==="passkey"&&e.enrolledInMfa)).sort(((e,r)=>r.firstVerifiedAt.valueOf()-e.firstVerifiedAt.valueOf()))[0],submitSuccess:f,hasBlockingError:n?.isBlocking??!1,error:n?.error,onClose:p,onBack:()=>{s(void 0),i(void 0)},handleSubmit:()=>w(m).catch(i)}):t==="sms"||t==="totp"?d.jsx(P,{selectedMethod:t,submitSuccess:f,hasBlockingError:n?.isBlocking??!1,handleSubmitCode:w,onClose:p,onBack:a.length>1?()=>s(void 0):void 0}):d.jsx(D,{mfaMethods:a,onSelect:g,handleClose:p}):null}};export{oe as MfaAuthVerifyFlowScreen,oe as default};
