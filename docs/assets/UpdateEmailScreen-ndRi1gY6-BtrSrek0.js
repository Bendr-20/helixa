import{j as e}from"./vendor-wallet-iWeBopzN.js";import{F as y}from"./EnvelopeIcon-dh-BYWnw.js";import{e as A}from"./Layouts-BlFm53ED-IHEHPiRi.js";import{r as o}from"./vendor-react-NLnOsXgy.js";import{b as v,I as U,a as C,aA as $,r as T,bp as M,a$ as I}from"./index-B6ULPMv2.js";import{V as P,m as q}from"./ModalHeader-D8-mhjp4-BJuJE5Zz.js";import{t as D,e as R}from"./EmailInputForm-Dgoii4vf-efp5kAmr.js";import{e as F}from"./ErrorMessage-D8VaAP5m-CAugZ5T2.js";import{n as W}from"./ScreenLayout-DTmQLGPf-D-E0Ah52.js";import{M as L}from"./mail-C8WLTF0W.js";import"./Screen-Bp-TN9gb-D0a7LCrT.js";import"./index-Dq_xe9dz-LsyqG-Zx.js";import"./createLucideIcon-4wkIQryq.js";const N=o.forwardRef(((s,l)=>{let[r,S]=o.useState(""),[t,c]=o.useState(""),[d,u]=o.useState(!1),{authenticated:g,user:i}=v(),{initUpdateEmail:p}=U(),{navigate:n,setModalData:f,currentScreen:w}=C(),{enabled:j,token:h}=$(),k=T(),b=M(r)&&(k.disablePlusEmails&&r.includes("+")?(t||c("Please enter a valid email address without a '+'."),!1):(t&&c(""),!0)),x=d||!b,m=()=>{!j||h||g?(async a=>{if(!i?.email)throw Error("User is required to have an email address to update it.");u(!0);try{await p({oldAddress:i.email.address,newAddress:r,captchaToken:a}),n("AwaitingPasswordlessCodeScreen")}catch(E){f({errorModalData:{error:E,previousScreen:w||"LandingScreen"}}),n("ErrorScreen")}u(!1)})(h):(f({captchaModalData:{callback:a=>{if(!i?.email)throw Error("User is required to have an email address to update it.");return p({oldAddress:i.email.address,newAddress:r,captchaToken:a})},userIntentRequired:!1,onSuccessNavigateTo:"AwaitingPasswordlessCodeScreen",onErrorNavigateTo:"ErrorScreen"}}),n("CaptchaScreen"))};return e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[t&&e.jsx(F,{style:{marginTop:"0.25rem",textAlign:"left"},children:t}),e.jsxs(K,{$error:!!t,children:[e.jsx(I,{children:e.jsx(L,{})}),e.jsx("input",{ref:l,id:"email-input",type:"email",placeholder:"your@email.com",onChange:a=>S(a.target.value),onKeyUp:a=>{a.key==="Enter"&&m()},value:r,autoComplete:"email"}),s.stacked?null:e.jsx(P,{isSubmitting:d,onClick:m,disabled:x,children:"Submit"})]})]}),s.stacked?e.jsx(q,{loadingText:null,loading:d,disabled:x,onClick:m,style:{width:"100%"},children:"Submit"}):null]})}));let V=D,K=R;const z=({title:s="Update your email",subtitle:l="Add the email address you'd like to use going forward. We'll send you a confirmation code"})=>e.jsx(W,{title:s,subtitle:l,icon:y,watermark:!0,children:e.jsx(A,{children:e.jsx(N,{stacked:!0})})}),te={component:()=>e.jsx(z,{})};export{te as UpdateEmailScreen,z as UpdateEmailScreenView,te as default};
