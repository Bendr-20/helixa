import{j as e}from"./vendor-wallet-iWeBopzN.js";import{T as d,g as u,F as N,m as v,$ as re}from"./ModalHeader-D8-mhjp4-qCa43FE9.js";import{F as D}from"./ShieldCheckIcon-CzN8v7s7.js";import{r as n}from"./vendor-react-NLnOsXgy.js";import{b as se,cn as z,a as G,r as J,I as ae,co as le,aC as ie,cg as ce,ch as me,ci as de,cj as ue}from"./index-5l2kKlPZ.js";import{t as he,f as fe,l as xe,i as je}from"./EnrollTotp-uSQt9d2Q-BWkdJjqX.js";import{F as pe}from"./CheckCircleIcon-DANTQeuo.js";import{F as K}from"./PhoneIcon-DQtHTqgM.js";import{w as ye,p as we}from"./ConnectPhoneForm-_lOAQG_X-DkAQ7vW9.js";import{a as ve,d as O,w as x,l as j,p,m as g,s as ge,x as Y,c as q,C as Ce,T as Fe}from"./PinInput-3SLvbnQa-CJg77EzR.js";import{ErrorScreenView as ke}from"./ErrorScreen-DtGc3Chy-C6Zq4wDi.js";import"./browser-CxT9TM-V.js";import"./FingerPrintIcon-CQ2UnhCX.js";import"./Chip-D2-wZOHJ-4K9ZBkqO.js";import"./LoadingSkeleton-U6-3yFwI-aWpSmv3o.js";import"./LinkPasskeyScreen-OxaghvUl-BIk8rNPe.js";import"./TodoList-CgrU7uwu-BsMNS64G.js";import"./createLucideIcon-4wkIQryq.js";import"./check-B9ysh8c4.js";import"./ScreenLayout-DTmQLGPf-D_knfIGa.js";import"./Screen-Bp-TN9gb-CRPonmPO.js";import"./index-Dq_xe9dz-Ckv7FBa_.js";import"./circle-check-big-YWHND4yl.js";import"./fingerprint-pattern-ONAhdVhn.js";import"./CopyToClipboard-DSTf_eKU-CoaQ9h32.js";import"./Layouts-BlFm53ED-DKNqCic5.js";import"./LabelXs-oqZNqbm_-gcfl1fK1.js";import"./Subtitle-CV-2yKE4-Bo2KP4gB.js";import"./Title-BnzYV3Is-BFl5seem.js";import"./shared-FM0rljBt-Bj7YrzK_.js";import"./QrCode-C1tgJtOy-BrxYoRJV.js";import"./reservoir-0wfhnc0j-DVCTjy6j.js";import"./lock-ZeGFRSFV.js";function Ee({title:o,titleId:m,...h},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":m},h),o?n.createElement("title",{id:m},o):null,n.createElement("path",{fillRule:"evenodd",d:"M8.603 3.799A4.49 4.49 0 0 1 12 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 0 1 3.498 1.307 4.491 4.491 0 0 1 1.307 3.497A4.49 4.49 0 0 1 21.75 12a4.49 4.49 0 0 1-1.549 3.397 4.491 4.491 0 0 1-1.307 3.497 4.491 4.491 0 0 1-3.497 1.307A4.49 4.49 0 0 1 12 21.75a4.49 4.49 0 0 1-3.397-1.549 4.49 4.49 0 0 1-3.498-1.306 4.491 4.491 0 0 1-1.307-3.498A4.49 4.49 0 0 1 2.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 0 1 1.307-3.497 4.49 4.49 0 0 1 3.497-1.307Zm7.007 6.387a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z",clipRule:"evenodd"}))}const be=n.forwardRef(Ee);function Se({title:o,titleId:m,...h},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":m},h),o?n.createElement("title",{id:m},o):null,n.createElement("path",{fillRule:"evenodd",d:"M4.5 3.75a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V6.75a3 3 0 0 0-3-3h-15Zm4.125 3a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Zm-3.873 8.703a4.126 4.126 0 0 1 7.746 0 .75.75 0 0 1-.351.92 7.47 7.47 0 0 1-3.522.877 7.47 7.47 0 0 1-3.522-.877.75.75 0 0 1-.351-.92ZM15 8.25a.75.75 0 0 0 0 1.5h3.75a.75.75 0 0 0 0-1.5H15ZM14.25 12a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H15a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3.75a.75.75 0 0 0 0-1.5H15Z",clipRule:"evenodd"}))}const Me=n.forwardRef(Se),Re=({appName:o,onComplete:m,onReset:h,onClose:a})=>{let[s,P]=n.useState(""),[T,W]=n.useState(!1),[E,C]=n.useState(null),[b,S]=n.useState("enroll"),{initEnrollmentWithSms:f,submitEnrollmentWithSms:A}=z(),{data:l}=G(),M=J();function F(){l?.mfaEnrollmentFlow?.onSuccess(),m()}return E?e.jsx(ke,{allowlistConfig:M.allowlistConfig,error:E,onBack:()=>C(null),onRetry:()=>C(null)}):e.jsxs(e.Fragment,b==="enroll"?{children:[e.jsx(d,{backFn:h,onClose:a},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(K,{})}),e.jsx(j,{children:"Set up SMS verification"}),e.jsxs(p,{children:["We'll text a verification code to this mobile device whenever you use your ",o," ","wallet."]}),e.jsxs(O,{children:[e.jsx(ye,{onSubmit:async function({qualifiedPhoneNumber:y}){try{await f({phoneNumber:y}),P(y),S("verify")}catch(i){C(i)}},hideRecent:!0}),e.jsxs(Ce,{children:["By providing your mobile number, you agree to receive text messages from ",M?.name,". Some carrier charges may apply"]})]}),e.jsx(u,{})]}:T?{children:[e.jsx(d,{onClose:F},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(pe,{})}),e.jsx(j,{children:"SMS verification added"}),e.jsxs(p,{children:["From now on, you'll enter the verification code sent to your mobile device whenever you use your ",o," wallet."]}),e.jsx(g,{children:e.jsx(v,{onClick:F,children:"Done"})}),e.jsx(u,{})]}:{children:[e.jsx(d,{backFn:function(){b==="verify"?S("enroll"):h()},onClose:a},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(K,{})}),e.jsx(j,{children:"Enter enrollment code"}),e.jsxs(O,{children:[e.jsx(Fe,{onChange:async function(y){try{if(!y)return;await A({phoneNumber:s,mfaCode:y}),W(!0)}catch(i){throw ce(i)?Error("You have exceeded the maximum number of attempts. Please close this window and try again in 10 seconds."):me(i)?Error("The code you entered is not valid"):de(i)?Error("You have exceeded the time limit for code entry. Please try again in 30 seconds."):ue(i)?Error("Verification canceled"):Error("Unknown error")}}}),e.jsxs(p,{children:["To continue, enter the 6-digit code sent to ",e.jsx("strong",{children:we(s)})]})]}),e.jsx(u,{})]})},mn={component:()=>{let{user:o,enrollInMfa:m,ready:h}=se(),[a,s]=n.useState(null),{unenrollWithSms:P,unenrollWithTotp:T,unenrollWithPasskey:W,submitEnrollmentWithTotp:E,initEnrollmentWithPasskey:C,submitEnrollmentWithPasskey:b,initEnrollmentWithTotp:S}=z(),{data:f,onUserCloseViaDialogOrKeybindRef:A}=G(),l=J(),{closePrivyModal:M}=ae(),{promptMfa:F}=le(),[y,i]=n.useState(!1),[R,$]=n.useState(null),[I,Z]=n.useState(null),r=()=>{M({shouldCallAuthOnSuccess:!0}),m(!1),setTimeout((()=>{s(null),$(null)}),500)},[Q,U]=n.useState(!1),[X,k]=n.useState();A.current=r;let _=o?.mfaMethods.includes("sms"),ee=!!o?.phone,ne=o?.mfaMethods.includes("totp"),te=o?.mfaMethods.includes("passkey"),B=_||ne||te,H=o?.linkedAccounts.filter((t=>t.type==="passkey")).map((t=>t.credentialId))??[];function w(){s(null),$(null)}async function V(t=H){U(!0);try{return await C(),await b({credentialIds:t},{removeForLogin:f?.mfaEnrollmentFlow?.shouldUnlinkOnUnenrollMfa}),f?.mfaEnrollmentFlow?.onSuccess(),r()}catch(c){k(c)}finally{U(!1)}}if(n.useEffect((()=>{B&&i(!0)}),[B]),!h||!o||!l)return e.jsxs(e.Fragment,{children:[e.jsx(d,{onClose:r},"header"),e.jsx(ve,{children:e.jsx(he,{})}),e.jsx(O,{children:e.jsx(ie,{})}),e.jsx(u,{})]});if(a==="sms")return e.jsxs(e.Fragment,{children:[e.jsx(d,{backFn:w,onClose:r},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(N,{})}),e.jsx(j,{children:"Remove SMS verification?"}),e.jsxs(p,{children:["MFA adds an extra layer of security to your ",l?.name," account. Make sure you have other methods to secure your account."]}),e.jsx(g,{children:e.jsx(v,{$warn:!0,onClick:async function(){s(null);try{await P()}catch{s(null)}},children:"Remove"})}),e.jsx(u,{})]});if(a==="totp")return e.jsxs(e.Fragment,{children:[e.jsx(d,{backFn:w,onClose:r},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(N,{})}),e.jsx(j,{children:"Remove authenticator app verification?"}),e.jsxs(p,{children:["MFA adds an extra layer of security to your ",l?.name," account. Make sure you have other methods to secure your account."]}),e.jsx(g,{children:e.jsx(v,{$warn:!0,onClick:async function(){s(null);try{await T()}catch{s(null)}},children:"Remove"})}),e.jsx(u,{})]});if(a==="passkey"){let t=f?.mfaEnrollmentFlow?.shouldUnlinkOnUnenrollMfa??!0;return e.jsxs(e.Fragment,{children:[e.jsx(d,{backFn:w,onClose:r},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(N,{})}),e.jsx(j,{children:"Are you sure you want to remove this passkey?"}),e.jsx(p,{children:t?"Removing your passkey will remove as both a verification method and a login method.":"Removing your passkey will remove as a verification method."}),e.jsx(g,{children:e.jsx(v,{$warn:!0,onClick:async function(){s(null);try{await W({removeForLogin:f?.mfaEnrollmentFlow?.shouldUnlinkOnUnenrollMfa})}catch{s(null)}},children:"Remove"})}),e.jsx(u,{})]})}if(f.mfaEnrollmentFlow.mfaMethods.length===0&&!B)return e.jsxs(e.Fragment,{children:[e.jsx(d,{onClose:r},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(D,{})}),e.jsx(j,{children:"Add more security"}),e.jsxs(p,{children:[l?.name," does not have any verification methods enabled."]}),e.jsx(g,{children:e.jsx(v,{onClick:r,children:"Close"})}),e.jsx(u,{})]});let L=!B&&!y;return L?e.jsxs(e.Fragment,{children:[e.jsx(d,{onClose:r},"header"),e.jsx(x,{style:{marginBottom:"1.5rem"},children:e.jsx(D,{})}),e.jsx(j,{children:"Transaction Protection"}),e.jsx(p,{children:"Set up transaction protection to add an extra layer of security to your account"}),e.jsxs(ge,{children:[e.jsxs(Y,{children:[e.jsx(q,{children:e.jsx(be,{})}),"Enable 2-Step verification for your ",l?.name," wallet."]}),e.jsxs(Y,{children:[e.jsx(q,{children:e.jsx(Me,{})}),"You'll be prompted to authenticate to complete transactions."]})]}),e.jsxs(g,{children:[e.jsx(v,{onClick:()=>i(!0),children:"Continue"}),e.jsx(re,{onClick:r,children:"Not now"})]}),e.jsx(u,{})]}):R==="sms"?e.jsx(Re,{appName:l?.name||"Privy",onComplete:r,onReset:w,onClose:r}):R==="totp"&&I?e.jsx(fe,{onClose:r,onReset:w,submitEnrollmentWithTotp:({mfaCode:t})=>(async function(c){try{return k(void 0),await E({mfaCode:c}),f?.mfaEnrollmentFlow?.onSuccess(),r()}catch(oe){k(oe)}finally{s(null)}})(t),totpInfo:{...I,appName:l?.name||"Privy"}}):R==="passkey"?e.jsx(xe,{onReset:w,onClose:r,submitEnrollmentWithPasskey:V}):e.jsx(je,{showIntro:L,userMfaMethods:o.mfaMethods,appMfaMethods:l.mfa.methods,userHasAuthSms:ee,backFn:function(){i(!1)},handleSelectMethod:async function(t){try{await F()}catch(c){return void k(c)}return t==="totp"?($(t),Z(null),void S().then((c=>{Z(c)})).catch((()=>{Z(null),w()}))):t==="passkey"&&H.length===1?await V():void $(t)},isTotpLoading:R==="totp"&&!I,isPasskeyLoading:Q,error:X,onClose:r,setRemovingMfaMethod:async t=>{try{await F()}catch(c){return void k(c)}s(t)}})}};export{mn as MfaEnrollmentFlowScreen,mn as default};
