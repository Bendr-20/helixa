import{j as e}from"./vendor-wallet-iWeBopzN.js";import{T as y,g as x,F as B,m as M}from"./ModalHeader-D8-mhjp4-DX69jG8H.js";import{F as G}from"./ShieldCheckIcon-CzN8v7s7.js";import{r as l}from"./vendor-react-NLnOsXgy.js";import{b as J,a as Q,r as X,aC as Y}from"./index-BgfVDz5U.js";import{t as Z,f as _,l as ee,i as te}from"./EnrollTotp-uSQt9d2Q-fDGF_fl5.js";import{a as re,d as oe,w as F,l as C,p as b,m as R}from"./PinInput-3SLvbnQa-yUOfbkWG.js";import"./browser-CxT9TM-V.js";import"./FingerPrintIcon-CQ2UnhCX.js";import"./PhoneIcon-DQtHTqgM.js";import"./Chip-D2-wZOHJ-DhFFw7NR.js";import"./LoadingSkeleton-U6-3yFwI-_vjw7Xt7.js";import"./ErrorScreen-DtGc3Chy-CFBe8QxC.js";import"./reservoir-0wfhnc0j-0WrQ1yPH.js";import"./ScreenLayout-DTmQLGPf-Bt1BELRe.js";import"./Screen-Bp-TN9gb-rb048SGm.js";import"./index-Dq_xe9dz-P-fAJJok.js";import"./createLucideIcon-4wkIQryq.js";import"./lock-ZeGFRSFV.js";import"./LinkPasskeyScreen-OxaghvUl-DDIbot0m.js";import"./TodoList-CgrU7uwu-BzM2XyBP.js";import"./check-B9ysh8c4.js";import"./circle-check-big-YWHND4yl.js";import"./fingerprint-pattern-ONAhdVhn.js";import"./CopyToClipboard-DSTf_eKU-BhGq9l75.js";import"./Layouts-BlFm53ED-XWaIgRi5.js";import"./LabelXs-oqZNqbm_-B6PyhOQN.js";import"./Subtitle-CV-2yKE4-jJa2XiCT.js";import"./Title-BnzYV3Is-iJgRzkr5.js";import"./shared-FM0rljBt-DNCGDuny.js";import"./QrCode-C1tgJtOy-DqFwPIbh.js";const Ie={component:()=>{let{user:a,ready:I}=J(),{data:j,onUserCloseViaDialogOrKeybindRef:P}=Q(),m=X(),[v,i]=l.useState(null),[h,p]=l.useState(null),[g,k]=l.useState(null),[W,L]=l.useState(!1),[S,n]=l.useState(!1),[f,o]=l.useState(),s=async()=>{f?E(f):a?await c({user:a}):E(Error("Must be logged in to manage MFA")),setTimeout((()=>{i(null),p(null)}),500)};if(P.current=s,!j?.mfaEnroll)throw Error("Missing modal data for MFA enrollment screen.");let{onFailure:E,onSuccess:c,onBack:w,mfaMethods:O,verify:A,generateTotpSecret:D,enrollTotp:H,unenrollTotp:K,enrollPasskey:T}=j.mfaEnroll,N=a?.mfaMethods.includes("sms"),V=a?.mfaMethods.includes("totp"),q=a?.mfaMethods.includes("passkey"),z=!!a?.phone,$=a?.linkedAccounts.filter((t=>t.type==="passkey")).map((t=>t.credentialId))??[];function u(){i(null),p(null),o(void 0)}async function U(t=$){try{o(void 0),n(!0);let r=await T(t);return await c({user:r})}catch(r){o(r)}finally{n(!1),L(!1)}}if(!I||!a||!m)return e.jsxs(e.Fragment,{children:[e.jsx(y,{onClose:s,backFn:w},"header"),e.jsx(re,{children:e.jsx(Z,{})}),e.jsx(oe,{children:e.jsx(Y,{})}),e.jsx(x,{})]});if(v==="sms")return null;if(v==="totp")return e.jsxs(e.Fragment,{children:[e.jsx(y,{backFn:u,onClose:s},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(B,{})}),e.jsx(C,{children:"Remove authenticator app verification?"}),e.jsxs(b,{children:["MFA adds an extra layer of security to your ",m?.name," account. Make sure you have other methods to secure your account."]}),e.jsx(R,{children:e.jsx(M,{$warn:!0,onClick:async function(){try{o(void 0),n(!0);let t=await K();return await c({user:t})}catch(t){o(t)}finally{n(!1),i(null)}},loading:S,children:"Remove"})}),e.jsx(x,{})]});if(v==="passkey"){let t=j.mfaEnroll.shouldUnlinkOnUnenrollMfa??!0;return e.jsxs(e.Fragment,{children:[e.jsx(y,{backFn:u,onClose:s},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(B,{})}),e.jsx(C,{children:"Are you sure you want to remove this passkey?"}),e.jsx(b,{children:t?"Removing your passkey will remove as both a verification method and a login method.":"Removing your passkey will remove as a verification method."}),e.jsx(R,{children:e.jsx(M,{$warn:!0,onClick:async function(){try{o(void 0),n(!0);let r=await T([]);return await c({user:r})}catch(r){o(r)}finally{n(!1),i(null)}},loading:S,children:"Remove"})}),e.jsx(x,{})]})}return O.length!==0||N||V||q?h==="sms"?null:h==="totp"&&g?e.jsx(_,{onClose:s,onReset:u,submitEnrollmentWithTotp:t=>(async function(r){try{o(void 0),n(!0);let d=await H(r);return await c({user:d})}catch(d){o(d)}finally{n(!1),i(null)}})(t.mfaCode),error:f,totpInfo:{...g,appName:m?.name||"Privy"}}):h==="passkey"?e.jsx(ee,{onReset:u,onClose:s,submitEnrollmentWithPasskey:U}):e.jsx(te,{showIntro:!0,userMfaMethods:a.mfaMethods,appMfaMethods:m.mfa.methods,userHasAuthSms:z,backFn:w,handleSelectMethod:async function(t){o(void 0);try{await A()}catch(r){return void o(r)}return t==="totp"?(p(t),k(null),void D().then((({totpSecret:r,totpAuthUrl:d})=>{k({authUrl:d,secret:r})})).catch((()=>{k(null),u()}))):t==="passkey"&&$.length===1?await U():void p(t)},isTotpLoading:h==="totp"&&!g,isPasskeyLoading:W,error:f,onClose:s,setRemovingMfaMethod:async function(t){o(void 0);try{await A()}catch(r){return void o(r)}i(t)}}):e.jsxs(e.Fragment,{children:[e.jsx(y,{onClose:s,backFn:w},"header"),e.jsx(F,{style:{marginBottom:"1.5rem"},children:e.jsx(G,{})}),e.jsx(C,{children:"Add more security"}),e.jsxs(b,{children:[m?.name," does not have any verification methods enabled."]}),e.jsx(R,{children:e.jsx(M,{onClick:s,children:"Close"})}),e.jsx(x,{})]})}};export{Ie as MfaAuthEnrollmentFlowScreen,Ie as default};
