import{j as E}from"./vendor-wallet-iWeBopzN.js";import{r as m}from"./vendor-react-NLnOsXgy.js";import{b as L,a as D,r as M,I as N,aA as x,ao as g,cK as v,aB as O,E as u,aq as U}from"./index-nqQLabaT.js";import{a as j}from"./shouldProceedtoEmbeddedWalletCreationFlow-BMF_3TVv-Ba9bespR.js";import{n as k}from"./ScreenLayout-DTmQLGPf-doLdq1Eu.js";import{c as $}from"./telegram-B-JqnkqZ-DStSjuJ0.js";import"./ModalHeader-D8-mhjp4-BRSa_N4W.js";import"./Screen-Bp-TN9gb-BmbViW5p.js";import"./index-Dq_xe9dz-BTftPUoF.js";const F=({success:r,errorMessage:a,onRetry:c})=>{let s=r?"Successfully connected with Telegram":a?a.message:"Verifying connection to Telegram";return E.jsx(k,{title:s,subtitle:r?"You're good to go!":a?a.detail:"Just a few moments more",icon:$,iconVariant:"loading",iconLoadingStatus:{success:r,fail:!!a},secondaryCta:a?.retryable&&c?{label:"Retry",onClick:c}:void 0,watermark:!0})},Y={component:()=>{let{authenticated:r,logout:a,ready:c,user:s}=L(),{setModalData:A,navigate:l,resetNavigation:d,data:p}=D(),y=M(),{initLoginWithTelegram:R,loginWithTelegram:b,updateWallets:C,setReadyToTrue:w,closePrivyModal:_,createAnalyticsEvent:W,getAuthMeta:h}=N(),[f,I]=m.useState(!1),[S,o]=m.useState(void 0),i=x();async function T(){try{let e=await(async function(){let t;if(!r){if(i.enabled&&i.status==="error")throw new O(i.error,null,u.CAPTCHA_FAILURE);return i.enabled&&i.status!=="success"&&(i.execute(),t=await i.waitForResult()),t}})();await b({captchaToken:e}),I(!0),w(!0)}catch(e){if(e?.privyErrorCode===u.ALLOWLIST_REJECTED)return o(void 0),d(),void l("AllowlistRejectionScreen");if(e?.privyErrorCode===u.USER_LIMIT_REACHED)return console.error(new U(e).toString()),o(void 0),d(),void l("UserLimitReachedScreen");if(e?.privyErrorCode===u.USER_DOES_NOT_EXIST)return o(void 0),d(),void l("AccountNotFoundScreen");if(e?.privyErrorCode===u.ACCOUNT_TRANSFER_REQUIRED&&e.data?.data?.nonce)return o(void 0),d(),A({accountTransfer:{nonce:e.data?.data?.nonce,account:e.data?.data?.subject,telegramAuthResult:h()?.telegramAuthResult,telegramWebAppData:h()?.telegramWebAppData,displayName:e.data?.data?.account?.displayName,linkMethod:"telegram",embeddedWalletAddress:e.data?.data?.otherUser?.embeddedWalletAddress}}),void l("LinkConflictScreen");let{retryable:t,detail:n}=v(e);o({retryable:t,detail:n,message:"Authentication failed"})}}return m.useEffect((()=>{T()}),[]),m.useEffect((()=>{if(!(c&&r&&f&&s))return;if(y?.legal.requireUsersAcceptTerms&&!s.hasAcceptedTerms){let t=setTimeout((()=>{l("AffirmativeConsentScreen")}),g);return()=>clearTimeout(t)}if(j(s,y.embeddedWallets)){let t=setTimeout((()=>{A({createWallet:{onSuccess:()=>{},onFailure:n=>{console.error(n),W({eventName:"embedded_wallet_creation_failure_logout",payload:{error:n,provider:"telegram",screen:"TelegramAuthScreen"}}),a()},callAuthOnSuccessOnClose:!0}}),l("EmbeddedWalletOnAccountCreateScreen")}),g);return()=>clearTimeout(t)}C();let e=setTimeout((()=>_({shouldCallAuthOnSuccess:!0,isSuccess:!0})),g);return()=>clearTimeout(e)}),[c,r,f,s]),E.jsx(F,{success:f,errorMessage:S,onRetry:S?.retryable?async()=>{try{o(void 0),p?.telegramAuthModalData?.seamlessAuth||await R(void 0,p?.login?.disableSignup),await T()}catch(e){let{retryable:t,detail:n}=v(e);o({retryable:t,detail:n,message:"Authentication failed"})}}:void 0})},isCaptchaRequired:!0,isShownBeforeReady:!0};export{Y as TelegramAuthScreen,F as TelegramAuthScreenView,Y as default};
