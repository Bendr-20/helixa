import{a2 as Se,aP as Te,a3 as we,c as xe,h as Ce,aN as C,j as i}from"./vendor-wallet-CC_hGl00.js";import{F as ye}from"./CheckCircleIcon-DANTQeuo.js";import{r as a}from"./vendor-react-NLnOsXgy.js";import{c as be,n as Ee,s as Ne}from"./Layouts-BlFm53ED-DRrd2L2h.js";import{u as D}from"./ModalHeader-D8-mhjp4-B0BhkEeh.js";import{o as Fe}from"./ScreenHeader-CHmc4-Lu-Bf5lp8Wh.js";import{t as V}from"./FundWalletMethodHeader-Cfci4-83-B2Pkzy21.js";import{t as Ae}from"./index-Dq_xe9dz-NxrnrBli.js";import{r as G,I as $e,a as je,n as Ue,O as Be,M as Pe,_ as g,q as B,E as v,l as ke,f as Le}from"./index-443jfUVp.js";import{c as Me,n as qe}from"./useGetTokenPrice-BPBpM07F-D5IEqGJ1.js";import{t as Q}from"./analytics-mkkvFRju-DOXuftJB.js";import{u as Y,o as Z,s as z,r as J,d as K,f as We}from"./reservoir-0wfhnc0j-CZKab_gu.js";import{e as He}from"./getChainName-DjpPdUSc-c2urPd0g.js";import{t as Oe,n as Re}from"./transaction-CnfuREWo-nROljJQP.js";import{H as _e,Z as De}from"./BridgeNetworkSelectionView-CaDh-Zck-CAx_q1ab.js";import{I as Ve}from"./TransferOrBridgeLoadingScreen-DcCdHB-g-GRZM8RFT.js";import"./useGetSolPrice-DwwjjGbd-B1vB4p5Y.js";import"./getFormattedUsdFromLamports-B6EqSEho-C-HCdwKa.js";import"./getErc20Balance-DA4dGV9O-I9KjEgyM.js";import"./Value-tcJV9e0L-y0cud_0e.js";import"./LoadingSkeleton-U6-3yFwI-BdVOy9FC.js";import"./ErrorMessage-D8VaAP5m-CQKPnShu.js";import"./Subtitle-CV-2yKE4-Clzpo1mA.js";import"./Title-BnzYV3Is-CrYC9EeK.js";import"./WalletIcon-BrbXK2eY.js";import"./Chip-D2-wZOHJ-Cf1AlYiB.js";import"./shared-FM0rljBt-BQn4IgpG.js";import"./ChevronDownIcon-Drg772V5.js";import"./formatErc20TokenAmount-BuPk9xcy-CkAr4Oc0.js";import"./ethers-D1WT71Ay-BWG_DlAa.js";import"./styles-BmZHuqSX-D4HYn70r.js";import"./LinkPasskeyScreen-OxaghvUl-CtoTs72y.js";import"./TodoList-CgrU7uwu-MT584RV3.js";import"./createLucideIcon-4wkIQryq.js";import"./check-B9ysh8c4.js";import"./ScreenLayout-DTmQLGPf-CffAvz9d.js";import"./Screen-Bp-TN9gb-CYZ3B7LT.js";import"./circle-check-big-YWHND4yl.js";import"./fingerprint-pattern-ONAhdVhn.js";import"./formatters-DKeexg0i.js";import"./InjectedWalletIcon-DLcYOGDj-DUTcgSTH.js";import"./Address-BjZb-TIL-BDJ_o2xW.js";import"./copy-BmDK-JXv.js";import"./GlobeAltIcon-kW1lCngP.js";const Lt={component:()=>{let X=G(),{rpcConfig:P,appId:I,closePrivyModal:ee,createAnalyticsEvent:k}=$e(),{navigate:te,setModalData:ae,data:d}=je(),L=G(),{wallets:ne}=Ue(),[y,m]=a.useState(null),[ie,b]=a.useState(null),[p,re]=a.useState([]),[M,se]=a.useState(0),[q,E]=a.useState(!1),[W,S]=a.useState(!1),[N,F]=a.useState(!1),[A,H]=a.useState(!1),[oe,de]=a.useState(),[le,O]=a.useState();if(!d?.funding||d.funding.chainType!=="solana")throw Error("Invalid funding data");let{address:u,chain:T,connectedWallet:R}=d.funding,[w,ce]=a.useState(d.funding.amount),t=(R?.type==="ethereum"?R:void 0)??ne[0],ue=Be(t?.walletClientType||"unknown"),_=ue?.name||"wallet",[l,me]=a.useState(null);a.useEffect((()=>{(async()=>{if(!t)return;let e=await t.getEthereumProvider();me(Se({account:t.address,transport:Te(e)}).extend(we))})().catch(console.error)}),[t]);let[pe,fe]=a.useState(0n),he=Oe(pe);a.useEffect((()=>{let e=X.solanaRpcs[T];e?Pe({rpc:e.rpc,address:u}).then((s=>fe(BigInt(s)))).catch(console.error):console.warn("Unable to load solana rpc, skipping balance")}),[]);let[n,$]=a.useState(),{tokenPrice:ge}=Me("solana"),{fundingAmountInBaseUnit:x,fundingAmountInUsd:ve}=Re({amount:w,fee:0n,tokenPrice:ge,isUsdc:d.funding.isUSDC});if(a.useEffect((()=>{(async()=>{if(!l||!t)return;let e=["solana:testnet","solana:devnet"].includes(T);e&&console.warn("Solana testnets are not supported for bridging");let s=qe(L.chains).filter((({testnet:r})=>!!r===e)),f=(await _e({chains:s,address:t.address,appId:I,rpcConfig:P})).filter((r=>r.balance>0n));if(f.length<1)return void m(new g(`Wallet ${B(t.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE));f.sort(((r,U)=>Number(U.balance-r.balance)));let o=(await Promise.allSettled(f.map((async r=>({...r,quote:await Y({isTestnet:!1,input:Z({appId:I,amount:x.toString(),user:t.address,recipient:u,destinationChainId:J,destinationCurrency:z,originChainId:r.chain.id})})}))))).filter((r=>r.status==="fulfilled")).map((r=>r.value));if(o.length<1)return void m(new g(`Unable to fetch quotes for bridging. Wallet ${B(t.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE));let j=o.map((({quote:r,balance:U,chain:Ie})=>({bridgeTx:K(r),balance:U,chain:Ie,isErc20Quote:!1}))).filter((({bridgeTx:r})=>!!r));if(j.length>1)return void re(j);let h=j.at(0);h?(S(!0),$({data:h.bridgeTx.data,to:h.bridgeTx.to,value:h.bridgeTx.value,chain:h.chain})):m(new g(`Unable to select bridge option from quotes. Wallet ${B(t.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE))})().catch(console.error)}),[l]),a.useEffect((()=>{(async()=>{let e,s;if(!l||!t||q||N||!n)return;E(!0);let f=xe({chain:n.chain,transport:Ce(ke(n.chain,P,I))});try{e=await f.prepareTransactionRequest({account:t.address,to:n.to,chain:n.chain,data:n.data,value:BigInt(n.value??0)})}catch(o){console.error(o),p.length>1&&b(o.shortMessage??"Something went wrong")}if(e){E(!1),F(!0);try{await l.switchChain({id:n.chain.id})}catch{await l.addChain({chain:n.chain}),await l.switchChain({id:n.chain.id})}try{s=await l.sendTransaction(e)}catch(o){console.error(o),o.name==="TransactionExecutionError"&&(p.length<1?m(new g(o.shortMessage,void 0,v.TRANSACTION_FAILURE)):b(o.shortMessage??"Something went wrong"))}if(s)return await l.waitForTransactionReceipt({hash:s}),W?(O("pending"),void de(s)):(F(!1),H(!0),void k({eventName:Q,payload:{provider:"external",status:"success",txHash:s,address:t.address,chainId:n.chain.id,chainType:"ethereum",value:n.value?C(BigInt(n.value),18):void 0,token:"ETH",destination:u,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:C(x,9),destinationToken:"SOL"}}));F(!1)}else E(!1)})().catch(console.error)}),[l,n]),We({transactionHash:oe,isTestnet:!1,bridgingStatus:le,setBridgingStatus:O,onSuccess({transactionHash:e}){S(!1),H(!0),k({eventName:Q,payload:{provider:"external",status:"success",txHash:e,address:t?.address,chainId:n?.chain.id,chainType:"ethereum",value:n?.value?C(BigInt(n.value),18):void 0,token:"ETH",destination:u,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:C(x,9),destinationToken:"SOL"}})},onFailure({error:e}){S(!1),m(e)}}),a.useEffect((()=>{y&&(ae({funding:d?.funding,solanaFundingData:d?.solanaFundingData,sendTransaction:d?.sendTransaction,errorModalData:{error:y,previousScreen:"TransferFromWalletScreen"}}),te("ErrorScreen",!1))}),[y]),a.useEffect((()=>{if(!A)return;let e=setTimeout(ee,Le);return()=>clearTimeout(e)}),[A]),A)return i.jsxs(i.Fragment,{children:[i.jsx(V,{}),i.jsx(be,{}),i.jsxs(Ee,{children:[i.jsx(ye,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),i.jsx(Fe,{title:"Success!",description:`Youâ€™ve successfully added ${w} SOL to your ${L.name} wallet. It may take a minute before the funds are available to use.`})]}),i.jsx(Ne,{}),i.jsx(D,{})]});let c=p[M];return p.length>1&&c?i.jsx(De,{displayName:_,configuredFundingChain:T,formattedBalance:he,fundingAmount:w,fundingCurrency:"SOL",fundingAmountInUsd:ve,options:p,selectedOption:c,isPreparing:q,isSubmitting:N,addressToFund:u,fundingWalletAddress:t?.address||"",errorMessage:ie,onSubmit:()=>{d.funding?.amount!==w?(async function(){if(t&&c)try{let e=await Y({isTestnet:!1,input:Z({appId:I,amount:x.toString(),user:t.address,recipient:u,destinationChainId:J,destinationCurrency:z,originChainId:c.chain.id})}),s=K(e);if(!s)throw Error("Invalid transaction request");S(!0),$({data:s.data,to:s.to,value:s.value,chain:c.chain})}catch(e){console.error(e),m(new g("Unable to fetch quotes for bridging",e,v.INSUFFICIENT_BALANCE))}})().catch(console.error):$({to:c.bridgeTx.to,data:c.bridgeTx.data,value:c.bridgeTx.value,chain:c.chain})},onSelect:e=>{e!==M&&(b(null),se(e))},onAmountChange:ce}):N&&t?i.jsx(Ve,{walletClientType:t?.walletClientType||"unknown",displayName:_,addressToFund:u,isBridging:W,isErc20Flow:!1,chainId:"solana",chainName:He(T),totalPriceInUsd:void 0,totalPriceInNativeCurrency:void 0,gasPriceInUsd:void 0,gasPriceInNativeCurrency:void 0}):i.jsxs(i.Fragment,{children:[i.jsx(V,{}),i.jsx(Ae,{}),i.jsx("div",{style:{marginTop:"1rem"}}),i.jsx(D,{})]})}};export{Lt as AwaitingEvmToSolBridgingScreen,Lt as default};
