import{j}from"./vendor-wallet-iWeBopzN.js";import{r as a}from"./vendor-react-NLnOsXgy.js";import{b as U,I as $,a as k,r as L,bz as A,bA as T,bB as V,by as y}from"./index-D_D0BMvx.js";import{u as W,o as B}from"./SetWalletPasswordForm-0nuoz3XZ-Bupb9ePY.js";import"./ExclamationTriangleIcon-C_T-rHXN.js";import"./Layouts-BlFm53ED-DHgFiVBn.js";import"./ModalHeader-D8-mhjp4-CIe8RK52.js";import"./shared-CwuyxHmv-Bb5I5CF0.js";import"./Checkbox-BhNoOKjX-Cq217X5p.js";import"./CheckCircleIcon-BMq0VCCt.js";import"./ScreenHeader-CHmc4-Lu-_Lz9YGKZ.js";const Z={component:()=>{let[n,M]=a.useState(null),[R,w]=a.useState(!1),[l,o]=a.useState(null),[i,v]=a.useState(""),{authenticated:m,user:c}=U(),{client:P,walletProxy:h,refreshSessionAndUser:S,closePrivyModal:d,createAnalyticsEvent:r}=$(),{navigate:x,data:E,onUserCloseViaDialogOrKeybindRef:C}=k(),I=L(),{onSuccess:f,onFailure:p}=E.setWalletPassword,e=A(c),g=n?.recoveryMethod==="user-passcode",t=e?.recoveryMethod==="user-passcode";a.useEffect((()=>{m||(x("LandingScreen"),p(new T("User must be authenticated before setting a password on a Privy wallet")))}),[m]);let u=()=>l?(p(l),void d({shouldCallAuthOnSuccess:!1})):g?(f(n),void d({shouldCallAuthOnSuccess:!1})):(p(new y("Exited before password was added to wallet")),void d({shouldCallAuthOnSuccess:!1}));return C.current=u,j.jsx(W,{appName:I?.name||"privy",config:{initiatedBy:"user",onCancel:u},error:l?"An error has occurred, please try again.":void 0,buttonLoading:R,buttonHideAnimations:!1,password:i,isResettingPassword:t,onPasswordGenerate:()=>v(B()),onPasswordChange:v,onSubmit:async()=>{g?(f(n),d({shouldCallAuthOnSuccess:!1})):(w(!0),o(null),await(async()=>{let _=await P.getAccessToken();if(_&&c&&e?.address&&i&&h)try{r({eventName:"embedded_wallet_set_recovery_started",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t}});let{entropyId:s,entropyIdVerifier:N}=V(c);if(!(await h.setRecovery({accessToken:_,entropyId:s,entropyIdVerifier:N,recoveryPassword:i,recoveryMethod:"user-passcode"})).entropyId)return o(new y("Error setting password on privy wallet")),void r({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t,reason:"error setting password"}});let O=await S(),b=A(O);if(!b)return o(new y("Error setting password on privy wallet")),void r({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t,reason:"wallet disconnected"}});M(b),r({eventName:"embedded_wallet_set_recovery_completed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:t}})}catch(s){console.warn(s),o(s instanceof Error?s:Error("Error setting password on privy wallet")),r({eventName:"embedded_wallet_set_password_failed",payload:{walletAddress:e.address,reason:s}})}})(),w(!1))},onClose:u})}};export{Z as EmbeddedWalletPasswordUpdateScreen,Z as default};
