import{j as p}from"./vendor-wallet-iWeBopzN.js";import{r as s}from"./vendor-react-NLnOsXgy.js";import{a as P,r as C,I as b,b as _,ao as d,i as O,E as g,c as T}from"./index-b2ZJWELz.js";import{a as W}from"./shouldProceedtoEmbeddedWalletCreationFlow-BMF_3TVv-iZXTjCnI.js";import{n as x}from"./ScreenLayout-DTmQLGPf-BLSFLcCu.js";import{F as j}from"./fingerprint-pattern-ONAhdVhn.js";import"./ModalHeader-D8-mhjp4-p-dvf8C6.js";import"./Screen-Bp-TN9gb-ChtWRuoe.js";import"./index-Dq_xe9dz-DkQrSQxT.js";import"./createLucideIcon-4wkIQryq.js";const F=({status:e,passkeySignupFlow:n=!1,error:t,onRetry:o})=>p.jsx(x,{title:(()=>{switch(e){case"loading":return"Waiting for passkey";case"success":return"Success";case"error":return"Something went wrong"}})(),subtitle:p.jsx(R,{children:(()=>{switch(e){case"loading":return n?"Please follow prompts to register your passkey.":`Please follow prompts to verify your passkey.
You will have to sign up with another method first to register a passkey for your account.`;case"success":return"You've successfully logged in with your passkey.";case"error":if(t instanceof O){if(t.privyErrorCode===g.CANNOT_LINK_MORE_OF_TYPE)return"Cannot link more passkeys to account.";if(t.privyErrorCode===g.PASSKEY_NOT_ALLOWED)return`Passkey request timed out or rejected by user.
You will have to sign up with another method first to register a passkey for your account.`}return`An unknown error occurred.
You will have to sign up with another method first to register a passkey for your account.`}})()}),icon:j,iconVariant:"loading",iconLoadingStatus:{success:e==="success",fail:e==="error"},primaryCta:e==="error"&&o?{label:"Retry",onClick:o}:e==="success"?{label:"Continue",disabled:!0}:void 0,watermark:!0}),U={component:()=>{let{data:e,setModalData:n,navigate:t}=P(),o=C(),{loginWithPasskey:h,signupWithPasskey:w,closePrivyModal:k,createAnalyticsEvent:S}=b(),{user:a,logout:v}=_(),{passkeySignupFlow:f}=e?.passkeyAuthModalData??{},m=d-500,[u,c]=s.useState("loading"),[E,A]=s.useState(null),i=s.useRef([]),l=r=>{i.current=[r,...i.current]};s.useEffect((()=>()=>{i.current.forEach((r=>clearTimeout(r))),i.current=[]}),[]);let y=async()=>{c("loading");try{f?await w():await h(),c("success")}catch(r){A(r),c("error")}};return s.useEffect((()=>{if(u==="success"&&a){if(o?.legal.requireUsersAcceptTerms&&!a.hasAcceptedTerms)return void l(setTimeout((()=>{t("AffirmativeConsentScreen")}),m));if(!W(a,o?.embeddedWallets))return void l(setTimeout((()=>{k({shouldCallAuthOnSuccess:!0,isSuccess:!0})}),d));l(setTimeout((()=>{n({createWallet:{onSuccess:()=>{},onFailure:r=>{console.error(r),S({eventName:"embedded_wallet_creation_failure_logout",payload:{error:r,screen:"PasskeyStatusScreen"}}),v()},callAuthOnSuccessOnClose:!0}}),t("EmbeddedWalletOnAccountCreateScreen")}),m))}}),[a,u]),s.useEffect((()=>{y()}),[]),p.jsx(F,{status:u,passkeySignupFlow:f,error:E,onRetry:y})}};let R=T.span`
  white-space: pre-wrap;
`;export{U as PasskeyStatusScreen,F as PasskeyStatusScreenView,U as default};
