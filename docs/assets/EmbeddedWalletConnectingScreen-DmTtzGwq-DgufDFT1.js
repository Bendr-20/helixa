import{j as I}from"./vendor-wallet-iWeBopzN.js";import{r as y}from"./vendor-react-NLnOsXgy.js";import{b as F,I as V,a as P,br as g,bs as U}from"./index-DxyWhJfT.js";import{n as _}from"./ScreenLayout-DTmQLGPf-DJsNDrL6.js";import{C as M}from"./circle-x-CUSNfWSY.js";import"./ModalHeader-D8-mhjp4-CApr5P3u.js";import"./Screen-Bp-TN9gb-Bvc1xvK5.js";import"./index-Dq_xe9dz-v6de63i6.js";import"./createLucideIcon-4wkIQryq.js";const j=({connectionFailed:i,onClose:s})=>I.jsx(_,i?{title:"Something went wrong",subtitle:"We're on it. Please try again later.",icon:M,iconVariant:"error",primaryCta:{label:"Close",onClick:s},watermark:!0}:{title:"Connecting to your wallet",subtitle:"Please wait...",iconVariant:"loading",showClose:!0,onClose:s,watermark:!1}),B={component:()=>{let{authenticated:i,user:s}=F(),{client:f,closePrivyModal:u,createAnalyticsEvent:m,walletProxy:o}=V(),{navigate:n,data:v,setModalData:A,onUserCloseViaDialogOrKeybindRef:E}=P(),W=y.useMemo((()=>Date.now()),[]),[w,x]=y.useState(!1),{onCompleteNavigateTo:t,onFailure:h,shouldForceMFA:S,entropyId:c,entropyIdVerifier:d,recoveryMethod:l,connectingWalletAddress:b,isUnifiedWallet:T=!1}=v?.connectWallet,e=r=>{w||(x(!0),h(typeof r=="string"?Error(r):r))};return y.useEffect((()=>{let r;return i?o?((async()=>{let p=await f.getAccessToken();if(!p)return e("User must be authenticated and have a Privy wallet before it can be connected");try{if(!T){if(!c||!d)return e("For on-device first-class chain wallets, entropyId and entropyIdVerifier are required");await o.connect({accessToken:p,entropyId:c,entropyIdVerifier:d})}S&&await o.verifyMfa({accessToken:p});let a=(Date.now()-W)/1e3;t==="EmbeddedWalletKeyExportScreen"&&a<1?r=setTimeout((()=>{n(t,!1)}),1e3*(1-a)):n(t,!1)}catch(a){if(g(a)&&l==="privy"){let C=await f.getAccessToken();if(!C)return e("User must be authenticated and have a Privy wallet before it can be recovered");try{m({eventName:"embedded_wallet_pinless_recovery_started",payload:{walletAddress:b}}),(await o?.recover({accessToken:C,entropyId:c,entropyIdVerifier:d}))?.entropyId||e(Error("Unable to recover wallet")),t?n(t):u({shouldCallAuthOnSuccess:!1}),m({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:b}}),n(t)}catch{e("An error has occurred, please try again.")}}else g(a)&&l!=="privy"&&l!=="privy-v2"?(A({...v,recoverWallet:{entropyId:c,entropyIdVerifier:d,onCompleteNavigateTo:t,onFailure:h},recoveryOAuthStatus:{provider:l,action:"recover",isInAccountCreateFlow:!1,shouldCreateEth:!1,shouldCreateSol:!1}}),n(U(l))):e(a)}})(),()=>clearTimeout(r)):void 0:e("User must be authenticated and have a Privy wallet before it can be connected")}),[i,s,o]),E.current=()=>{e("User exited before wallet could be connected"),u({shouldCallAuthOnSuccess:!1})},I.jsx(j,{connectionFailed:w,onClose:()=>u({shouldCallAuthOnSuccess:!1})})}};export{B as EmbeddedWalletConnectingScreen,j as EmbeddedWalletConnectingView,B as default};
