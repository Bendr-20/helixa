import{j as u}from"./vendor-wallet-iWeBopzN.js";import{r}from"./vendor-react-NLnOsXgy.js";import{b as M,r as B,co as E}from"./index-sGJYFaSd.js";import{K as j,R as C,q as A,X as g}from"./to-ui-error-REESv0kM-84bZT2-9.js";import"./PinInput-3SLvbnQa-BajsV7_H.js";import"./FingerPrintIcon-CQ2UnhCX.js";import"./PhoneIcon-DQtHTqgM.js";import"./ShieldCheckIcon-CzN8v7s7.js";import"./ModalHeader-D8-mhjp4-XA-NU1Gv.js";import"./ScreenLayout-DTmQLGPf-BlqX97ue.js";import"./Screen-Bp-TN9gb-CzJwd7hm.js";import"./index-Dq_xe9dz-Ib9Th1lY.js";import"./ExclamationTriangleIcon-C_T-rHXN.js";import"./StackedContainer-B2vaEl56-BRm7eOny.js";import"./useGetTokenPrice-BPBpM07F-CbPBvB_1.js";import"./useGetSolPrice-DwwjjGbd-BlOrP3fl.js";import"./TransactionDetails-BurRo8R0-CjQniaaq.js";import"./WalletLink--05Hzo2b-B7H8EzTT.js";import"./ethers-D1WT71Ay-Bm_QsKrp.js";import"./getFormattedUsdFromLamports-B6EqSEho-C-HCdwKa.js";import"./transaction-CnfuREWo-nROljJQP.js";import"./Layouts-BlFm53ED-DCCHjgBa.js";import"./ChevronDownIcon-Drg772V5.js";const _=({onClose:n})=>{let{user:l}=M(),p=B(),a=r.useMemo((()=>l?.mfaMethods.filter((t=>t!=="passkey"||!p.globalDisablePasskeys))??[]),[l?.mfaMethods,p.globalDisablePasskeys]),[o,i]=r.useState(a[0]??null),{init:d,cancel:w,submit:h}=E(),[y,k]=r.useState(!1),[v,x]=r.useState(null),[c,s]=r.useState();r.useEffect((()=>{i(a[0]??null)}),[a]);let m=r.useRef(!1);async function b(t){s(void 0);try{if(!t||!o)return;await h(o,t),k(!0),s(void 0),n()}catch(e){throw g(e).error}}async function S(t){if(t!=="passkey")try{i(t),await d(t)}catch(e){console.error(e)}else try{i(t);let e=await d(t);if(!e)throw Error("something went wrong");x(e),await h(t,e),k(!0),s(void 0),n()}catch(e){s(g(e))}}r.useEffect((()=>{!m.current&&o&&(m.current=!0,S(o).finally((()=>{m.current=!1})))}),[]);let f=()=>{i(null),s(void 0),w(),n()};return l?o==="passkey"?u.jsx(j,{account:l.linkedAccounts.filter((t=>t.type==="passkey"&&t.enrolledInMfa)).sort(((t,e)=>e.firstVerifiedAt.valueOf()-t.firstVerifiedAt.valueOf()))[0],submitSuccess:y,hasBlockingError:c?.isBlocking??!1,error:c?.error,onClose:f,onBack:()=>{i(null),s(void 0)},handleSubmit:()=>b(v).catch(s)}):o?u.jsx(C,{submitSuccess:y,hasBlockingError:c?.isBlocking??!1,handleSubmitCode:b,selectedMethod:o,onClose:f,onBack:a.length>1?()=>i(null):void 0}):u.jsx(A,{mfaMethods:a,onSelect:S,handleClose:f}):null};export{_ as MfaVerifyFlowScreen,_ as default};
