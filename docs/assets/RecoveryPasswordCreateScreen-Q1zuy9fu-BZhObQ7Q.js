import{j as A}from"./vendor-wallet-iWeBopzN.js";import{r as a}from"./vendor-react-NLnOsXgy.js";import{a as T,r as M,bw as W,b as R,I as j,aR as L,by as S}from"./index-CG5B329X.js";import{u as $,o as D}from"./SetWalletPasswordForm-0nuoz3XZ-DqiTgw8w.js";import"./ExclamationTriangleIcon-C_T-rHXN.js";import"./Layouts-BlFm53ED-Le3CFj-t.js";import"./ModalHeader-D8-mhjp4-B_Pl_b4i.js";import"./shared-CwuyxHmv-DEkMcbDJ.js";import"./Checkbox-BhNoOKjX-B2hGfGQ6.js";import"./CheckCircleIcon-BMq0VCCt.js";import"./ScreenHeader-CHmc4-Lu-Bu26PBnv.js";const J={component:()=>{let{navigate:u,data:v,onUserCloseViaDialogOrKeybindRef:b}=T(),C=M(),[g,x]=a.useState(""),[c,d]=a.useState(!1),[s,h]=a.useState(),[n,P]=a.useState(null),{create:r}=W(),{authenticated:m,user:o}=R(),{closePrivyModal:l,isNewUserThisSession:E,initializeWalletProxy:U}=j(),{onSuccess:w,onFailure:i,callAuthOnSuccessOnClose:p,shouldCreateEth:f,shouldCreateSol:y}=v.createWallet,[t,I]=a.useState(null),O=new L((async()=>{try{let e;if(f&&y)e=await r({recoveryMethod:"user-passcode",recoveryPassword:s,chainType:"ethereum",walletIndex:0,latestUser:o}),e=await r({chainType:"solana",walletIndex:0,latestUser:e.user});else if(y)e=await r({recoveryMethod:"user-passcode",recoveryPassword:s,chainType:"solana",walletIndex:0,latestUser:o});else{if(!f)throw Error("Invalid args to create wallet");e=await r({recoveryMethod:"user-passcode",recoveryPassword:s,chainType:"ethereum",walletIndex:0,latestUser:o})}I(e),E?u("EmbeddedWalletCreatedScreen"):(w(e),l({shouldCallAuthOnSuccess:p}))}catch(e){x(e.message)}}));return a.useEffect((()=>{n||U(3e4).then((e=>P(e)))}),[n]),a.useEffect((()=>{if(!m||!o)return u("LandingScreen"),void i(Error("User must be authenticated before creating a Privy wallet"))}),[m]),b.current=()=>null,A.jsx($,{config:{initiatedBy:"automatic"},appName:C?.name||"privy",loading:!n,buttonLoading:c,buttonHideAnimations:!t&&c,isResettingPassword:!1,error:g,password:s||"",onClose:()=>{t&&t.account.recoveryMethod!=="user-passcode"?(i(new S("User created a wallet but failed to set a password for it")),l({shouldCallAuthOnSuccess:!1})):t?(w(t),l({shouldCallAuthOnSuccess:p})):(i(new S("User wallet creation failed")),l({shouldCallAuthOnSuccess:!1}))},onPasswordChange:h,onPasswordGenerate:()=>h(D()),onSubmit:async()=>(d(!0),O.execute().then((()=>new Promise((e=>setTimeout(e,250))))).finally((()=>d(!1))))})}};export{J as EmbeddedWalletPasswordCreateScreen,J as default};
