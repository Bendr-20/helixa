import{j as g}from"./vendor-wallet-iWeBopzN.js";import{r as u}from"./vendor-react-NLnOsXgy.js";import{a as $,r as b,b as j,I as K,bw as M,aV as V,aW as k,bx as F,aR as L,by as D}from"./index-D53ubkWQ.js";import{n as Z}from"./ScreenLayout-DTmQLGPf-DtJYJrHI.js";import{C as q}from"./circle-x-CUSNfWSY.js";import"./ModalHeader-D8-mhjp4-D1Pw1KxN.js";import"./Screen-Bp-TN9gb-B0HaWEnq.js";import"./index-Dq_xe9dz-Bre0Q5Hc.js";import"./createLucideIcon-4wkIQryq.js";async function S(r,a){let l=`${r}-auto-${a==="ethereum"?"eth":"sol"}`,c=new TextEncoder().encode(l);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",c))).map((s=>s.toString(16).padStart(2,"0"))).join("")}const G=({errorMessage:r,onClose:a})=>g.jsx(Z,r?{title:"Something went wrong",subtitle:r,icon:q,iconVariant:"error",primaryCta:{label:"Close",onClick:a},watermark:!0}:{title:"Creating your wallet",subtitle:"Please wait...",iconVariant:"loading",watermark:!1}),ee={component:()=>{let{setModalData:r,navigate:a,data:l,onUserCloseViaDialogOrKeybindRef:c}=$(),s=b(),[v,x]=u.useState(""),{embeddedWallets:O}=b(),{authenticated:m,user:e}=j(),{closePrivyModal:d,walletProxy:W,client:A}=K(),{onSuccess:E,onFailure:w,callAuthOnSuccessOnClose:y,shouldCreateEth:U,shouldCreateSol:I}=l.createWallet,h=s.embeddedWallets.mode==="legacy-embedded-wallets-only"&&s?.embeddedWallets.requireUserOwnedRecoveryOnCreate===!0,[p,R]=u.useState(null),{create:o}=M(),n=U??(!!e&&V(e,s.embeddedWallets.ethereum.createOnLogin)),i=I??(!!e&&k(e,s.embeddedWallets.solana.createOnLogin)),P=new L((async()=>{let T=await A.getAccessToken();if(e&&T&&W)try{let t,C=await S(e.id,"ethereum"),f=await S(e.id,"solana");if(n&&i)t=await o({chainType:"ethereum",walletIndex:0,latestUser:e,idempotencyKey:C}),t=await o({chainType:"solana",walletIndex:0,latestUser:t.user,idempotencyKey:f});else if(i)t=await o({chainType:"solana",walletIndex:0,latestUser:e,idempotencyKey:f});else{if(!n)return void d({shouldCallAuthOnSuccess:y});t=await o({chainType:"ethereum",walletIndex:0,latestUser:e,idempotencyKey:C})}R(t),a("EmbeddedWalletCreatedScreen")}catch(t){x(t.message)}}));return u.useEffect((()=>m&&e?h?(r({...l,createWallet:{...l.createWallet,shouldCreateEth:n,shouldCreateSol:i},recoverySelection:{...l?.recoverySelection,isInAccountCreateFlow:!0,shouldCreateEth:n,shouldCreateSol:i}}),a(F({walletAction:"create",showAutomaticRecovery:!1,availableRecoveryMethods:O.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:!1,isResettingPassword:!1}))):void P.execute():(a("LandingScreen"),void w(Error("User must be authenticated before creating a Privy wallet")))),[h,m]),c.current=()=>null,g.jsx(G,{errorMessage:v||void 0,onClose:()=>{p?(E(p),d({shouldCallAuthOnSuccess:y})):(w(new D("User wallet creation failed")),d({shouldCallAuthOnSuccess:!1}))}})}};export{ee as EmbeddedWalletOnAccountCreateScreen,G as EmbeddedWalletOnAccountCreateView,ee as default};
