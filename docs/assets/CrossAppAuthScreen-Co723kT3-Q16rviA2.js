import{j as C}from"./vendor-wallet-iWeBopzN.js";import{r as i}from"./vendor-react-NLnOsXgy.js";import{r as I,a as T,I as U,aQ as E,_ as A,aR as $,ao as h,ap as x,E as R}from"./index-De1e-9qj.js";import{a as O}from"./shouldProceedtoEmbeddedWalletCreationFlow-BMF_3TVv-i7m6-TDK.js";import{n as W}from"./ScreenLayout-DTmQLGPf-DL3SxT1x.js";import"./ModalHeader-D8-mhjp4-Bvbmkp_D.js";import"./Screen-Bp-TN9gb-Dtmnx3Ly.js";import"./index-Dq_xe9dz-D17kZ2yT.js";const _=({providerApp:a,success:s,error:r,onClose:c})=>{let{title:u,subtitle:d}=i.useMemo((()=>s?{title:`Successfully connected with ${a.name}`,subtitle:"You're good to go!"}:r?{title:"Authentication failed",subtitle:r.message}:{title:`Connecting to ${a.name}`,subtitle:`Please check the pop-up from ${a.name} to continue`}),[s,r,a.name]);return C.jsx(W,{title:u,subtitle:d,icon:a.logoUrl,iconVariant:"loading",iconLoadingStatus:{success:s,fail:!!r},onBack:c,watermark:!0})},B={component:()=>{let a=I(),{data:s,navigate:r,setModalData:c,onUserCloseViaDialogOrKeybindRef:u}=T(),{crossAppAuthFlow:d,updateWallets:y,closePrivyModal:g,createAnalyticsEvent:b}=U(),{logout:v}=E(),[o,n]=i.useState({}),e=s?.crossAppAuth,p=new A(`There was an issue connecting your ${e?.name} account. Please try again.`),w=new $((async l=>{if(e?.popup)try{let t=await d({appId:l,popup:e.popup,action:e.action,disableSignup:e.disableSignup});n({data:t})}catch(t){if(t instanceof A)n({error:t});else if(t instanceof x){if(t.privyErrorCode===R.ACCOUNT_TRANSFER_REQUIRED&&t.data?.data?.nonce)return c({accountTransfer:{nonce:t.data?.data?.nonce,account:t.data?.data?.subject,displayName:t.data?.data?.account?.displayName,linkMethod:`privy:${e.appId}`,embeddedWalletAddress:t.data?.data?.otherUser?.embeddedWalletAddress,oAuthUserInfo:t.data?.data?.otherUser?.oAuthUserInfo}}),void r("LinkConflictScreen");e.popup&&e.popup.close(),n({error:p})}else n({error:p})}else n({error:p})})),m=()=>{o.data&&(y(),e?.onSuccess(o.data),g({shouldCallAuthOnSuccess:!0,isSuccess:!0})),e?.onError(o.error??new A("User canceled flow")),g({shouldCallAuthOnSuccess:!1,isSuccess:!1})};return u.current=m,i.useEffect((()=>{e?.appId?.length&&w.execute(e.appId)}),[e?.appId]),i.useEffect((()=>{if(!o.data)return;let l=o.data;if(a.legal.requireUsersAcceptTerms&&!l.hasAcceptedTerms){let f=setTimeout((()=>{r("AffirmativeConsentScreen")}),h);return()=>clearTimeout(f)}if(O(l,a.embeddedWallets)){let f=setTimeout((()=>{c({createWallet:{onSuccess:()=>{},onFailure:S=>{console.error(S),b({eventName:"embedded_wallet_creation_failure_logout",payload:{error:S,provider:`privy:${e?.appId}`,screen:"CrossAppAuthScreen"}}),v()},callAuthOnSuccessOnClose:!0}}),r("EmbeddedWalletOnAccountCreateScreen")}),h);return()=>clearTimeout(f)}let t=setTimeout(m,h);return()=>clearTimeout(t)}),[o.data]),e?.appId?C.jsx(_,{providerApp:{id:e?.appId,logoUrl:e?.logoUrl,name:e?.name},success:!!o.data,error:o.error,onClose:m}):(console.warn("Missing data for Screen"),null)},isShownBeforeReady:!0};export{B as CrossAppAuthScreen,_ as CrossAppAuthScreenView,B as default};
