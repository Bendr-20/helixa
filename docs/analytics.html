<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HELIXA ANALYTICS DASHBOARD</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--green:#00ff41;--dim:#00ff4180;--dimmer:#00ff4133;--card-bg:#0d0d14;--border:#00ff4122}
body{background:var(--bg);color:var(--green);font-family:'JetBrains Mono',monospace;font-size:14px;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,255,65,.03) 2px,rgba(0,255,65,.03) 4px);pointer-events:none;z-index:9999}
body::after{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(ellipse at center,transparent 60%,rgba(0,0,0,.7) 100%);pointer-events:none;z-index:9998}
.container{max-width:1200px;margin:0 auto;padding:20px;position:relative;z-index:1}
h1{font-family:'Orbitron',sans-serif;font-weight:900;font-size:clamp(18px,4vw,32px);text-align:center;margin-bottom:6px;text-shadow:0 0 20px var(--green),0 0 40px var(--dim);letter-spacing:4px}
.subtitle{text-align:center;color:var(--dim);font-size:12px;margin-bottom:24px}
.period-selector{display:flex;justify-content:center;gap:8px;margin-bottom:24px}
.period-btn{background:transparent;border:1px solid var(--border);color:var(--dim);font-family:'JetBrains Mono',monospace;font-size:13px;padding:6px 18px;cursor:pointer;transition:.2s}
.period-btn:hover,.period-btn.active{background:var(--dimmer);color:var(--green);border-color:var(--green);text-shadow:0 0 8px var(--green)}
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
.card{background:var(--card-bg);border:1px solid var(--border);padding:20px;position:relative;overflow:hidden}
.card::before{content:'';position:absolute;top:0;left:0;width:100%;height:1px;background:linear-gradient(90deg,transparent,var(--green),transparent)}
.card-label{font-family:'Orbitron',sans-serif;font-size:10px;color:var(--dim);letter-spacing:2px;margin-bottom:8px;text-transform:uppercase}
.card-value{font-family:'Orbitron',sans-serif;font-size:clamp(20px,3vw,28px);font-weight:700;text-shadow:0 0 10px var(--dim)}
.card-sub{font-size:11px;color:var(--dim);margin-top:6px}
.card-sub.positive{color:#00ff41}
.card-sub.negative{color:#ff4141}
.section{background:var(--card-bg);border:1px solid var(--border);padding:20px;margin-bottom:24px;position:relative}
.section::before{content:'';position:absolute;top:0;left:0;width:100%;height:1px;background:linear-gradient(90deg,transparent,var(--green),transparent)}
.section h2{font-family:'Orbitron',sans-serif;font-size:14px;letter-spacing:2px;margin-bottom:16px;text-shadow:0 0 8px var(--dim)}
.chart{display:flex;align-items:flex-end;gap:3px;height:180px;padding-top:20px}
.bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;height:100%}
.bar{width:100%;min-width:4px;background:linear-gradient(180deg,var(--green),#00ff4155);border-top:2px solid var(--green);transition:height .4s;margin-top:auto;position:relative;box-shadow:0 0 6px var(--dimmer)}
.bar:hover{background:var(--green);box-shadow:0 0 12px var(--green)}
.bar-label{font-size:9px;color:var(--dim);margin-top:4px;writing-mode:vertical-rl;text-orientation:mixed;max-height:40px;overflow:hidden}
.bar-tooltip{position:absolute;top:-22px;left:50%;transform:translateX(-50%);font-size:10px;color:var(--green);white-space:nowrap;display:none}
.bar:hover .bar-tooltip{display:block}
.two-col{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px}
table{width:100%;border-collapse:collapse}
th{font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;text-align:left;color:var(--dim);padding:8px 6px;border-bottom:1px solid var(--border)}
td{padding:8px 6px;border-bottom:1px solid var(--border);font-size:13px;max-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
td:last-child,th:last-child{text-align:right}
.loading{color:var(--dim);font-style:italic}
.refresh-note{text-align:center;color:var(--dimmer);font-size:11px;margin-top:16px;padding-bottom:20px}
@media(max-width:768px){
  .stats-row{grid-template-columns:repeat(2,1fr)}
  .two-col{grid-template-columns:1fr}
  .chart{height:120px}
}
@media(max-width:480px){
  .stats-row{grid-template-columns:1fr}
  .container{padding:12px}
}
</style>
</head>
<body>
<div class="container">
  <h1>HELIXA ANALYTICS DASHBOARD</h1>
  <div class="subtitle" id="lastUpdate">INITIALIZING...</div>

  <div class="period-selector">
    <button class="period-btn" data-days="7">7D</button>
    <button class="period-btn" data-days="14">14D</button>
    <button class="period-btn active" data-days="30">30D</button>
  </div>

  <div class="stats-row">
    <div class="card"><div class="card-label">Total Page Views</div><div class="card-value" id="totalViews">—</div><div class="card-sub" id="totalViewsSub"></div></div>
    <div class="card"><div class="card-label">Agents Minted</div><div class="card-value" id="agentsMinted">—</div><div class="card-sub" id="agentsMintedSub"></div></div>
    <div class="card"><div class="card-label">Terminal Agents</div><div class="card-value" id="terminalAgents">—</div><div class="card-sub" id="terminalAgentsSub"></div></div>
    <div class="card"><div class="card-label">$CRED Price</div><div class="card-value" id="credPrice">—</div><div class="card-sub" id="credPriceSub"></div></div>
  </div>

  <div class="section">
    <h2>DAILY VIEWS</h2>
    <div class="chart" id="dailyChart"><span class="loading">Loading chart data...</span></div>
  </div>

  <div class="two-col">
    <div class="section">
      <h2>TOP PAGES</h2>
      <table id="topPages"><thead><tr><th>PATH</th><th>VIEWS</th></tr></thead><tbody><tr><td colspan="2" class="loading">Loading...</td></tr></tbody></table>
    </div>
    <div class="section">
      <h2>TOP REFERRERS</h2>
      <table id="topReferrers"><thead><tr><th>REFERRER</th><th>VIEWS</th></tr></thead><tbody><tr><td colspan="2" class="loading">Loading...</td></tr></tbody></table>
    </div>
  </div>

  <div class="two-col">
    <div class="section">
      <h2>PLATFORM STATS</h2>
      <table id="platformStats"><tbody><tr><td colspan="2" class="loading">Loading...</td></tr></tbody></table>
    </div>
    <div class="section">
      <h2>TOKEN STATS</h2>
      <table id="tokenStats"><tbody><tr><td colspan="2" class="loading">Loading...</td></tr></tbody></table>
    </div>
  </div>

  <div class="refresh-note">Auto-refreshes every 60s · Data fetched client-side</div>
</div>

<script>
let currentDays = 30;

const $ = id => document.getElementById(id);
const fmt = n => n == null ? '—' : Number(n).toLocaleString();
const fmtUsd = n => n == null ? '—' : '$' + Number(n).toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 6});
const fmtPct = n => n == null ? '—' : (n >= 0 ? '+' : '') + Number(n).toFixed(2) + '%';

async function fetchJson(url) {
  try { const r = await fetch(url); if (!r.ok) throw 0; return await r.json(); } catch { return null; }
}

function fillTable(id, rows, hasHeader) {
  const table = $(id);
  const tbody = table.querySelector('tbody') || table;
  tbody.innerHTML = rows.length ? rows.map(r => `<tr>${r.map((c,i) => `<td>${c}</td>`).join('')}</tr>`).join('') : '<tr><td colspan="2" style="color:var(--dim)">No data available</td></tr>';
}

async function loadAnalytics() {
  const data = await fetchJson(`https://api.helixa.xyz/api/v2/analytics?days=${currentDays}`);
  if (data) {
    $('totalViews').textContent = fmt(data.total);
    $('totalViewsSub').textContent = `Last ${data.days || currentDays} days`;

    // Chart
    const days = (data.byDay || []).slice(-currentDays);
    const max = Math.max(...days.map(d => d.views), 1);
    $('dailyChart').innerHTML = days.length ? days.map(d => {
      const h = Math.max((d.views / max) * 100, 2);
      const label = d.day.slice(5);
      return `<div class="bar-wrap"><div class="bar" style="height:${h}%"><span class="bar-tooltip">${label}: ${d.views}</span></div><span class="bar-label">${label}</span></div>`;
    }).join('') : '<span class="loading">No chart data yet</span>';

    // Tables
    const pages = (data.byPage || []).slice(0, 10);
    fillTable('topPages', pages.map(p => [p.path, fmt(p.views)]));
    const refs = (data.byReferrer || []).slice(0, 10);
    fillTable('topReferrers', refs.map(r => [r.referrer || '(direct)', fmt(r.views)]));
  }
}

async function loadPlatform() {
  const data = await fetchJson('https://api.helixa.xyz/api/v2/stats');
  if (data) {
    $('agentsMinted').textContent = fmt(data.totalAgents);
    $('agentsMintedSub').textContent = `${fmt(data.totalNamed)} named · ${fmt(data.holderCount)} holders`;
    fillTable('platformStats', [
      ['Total Agents', fmt(data.totalAgents)],
      ['Named Agents', fmt(data.totalNamed)],
      ['Soulbound', fmt(data.totalSoulbound)],
      ['Holders', fmt(data.holderCount)],
    ]);
  }
}

async function loadTerminal() {
  const data = await fetchJson('https://api.helixa.xyz/api/terminal/agents?limit=1');
  const s = data?.stats;
  if (s) {
    $('terminalAgents').textContent = fmt(s.total);
    $('terminalAgentsSub').textContent = `Avg score: ${s.avgScore != null ? Number(s.avgScore).toFixed(1) : '—'} · x402: ${fmt(s.x402)}`;
  }
}

async function loadToken() {
  const data = await fetchJson('https://api.dexscreener.com/tokens/v1/base/0xAB3f23c2ABcB4E12Cc8B593C218A7ba64Ed17Ba3');
  const t = Array.isArray(data) ? data[0] : data;
  if (t) {
    const price = t.priceUsd ?? t.price;
    const change = t.priceChange?.h24 ?? t.price_change_24h;
    $('credPrice').textContent = price != null ? fmtUsd(price) : '—';
    const sub = $('credPriceSub');
    if (change != null) { sub.textContent = fmtPct(change) + ' (24h)'; sub.className = 'card-sub ' + (change >= 0 ? 'positive' : 'negative'); }

    const mc = t.marketCap ?? t.fdv;
    const vol = t.volume?.h24 ?? t.volume_24h;
    const liq = t.liquidity?.usd ?? t.liquidity;
    fillTable('tokenStats', [
      ['Price', price != null ? fmtUsd(price) : '—'],
      ['Market Cap', mc != null ? fmtUsd(mc) : '—'],
      ['24h Volume', vol != null ? fmtUsd(vol) : '—'],
      ['Liquidity', liq != null ? fmtUsd(liq) : '—'],
      ['24h Change', change != null ? fmtPct(change) : '—'],
    ]);
  }
}

async function loadAll() {
  $('lastUpdate').textContent = 'UPDATING...';
  await Promise.all([loadAnalytics(), loadPlatform(), loadTerminal(), loadToken()]);
  $('lastUpdate').textContent = 'LAST UPDATE: ' + new Date().toLocaleTimeString() + ' · ' + currentDays + 'D WINDOW';
}

document.querySelectorAll('.period-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentDays = +btn.dataset.days;
    loadAll();
  });
});

loadAll();
setInterval(loadAll, 60000);
</script>
<script>new Image().src="https://api.helixa.xyz/api/v2/t.gif?p="+encodeURIComponent(location.pathname+location.search)+"&r="+encodeURIComponent(document.referrer);</script>
</body>
</html>
